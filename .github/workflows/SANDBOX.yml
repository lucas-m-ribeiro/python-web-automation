name: SANDBOX TEST

on:
  workflow_dispatch:
    inputs:
     execution:
       type: string
       description: Insira o teste que vc quer executar, ou execute todos os teste apenas clicando no bot√£o "RUN WORKFLOW"
       required: false
    
jobs:
  run-test:
    runs-on: ubuntu-latest
    
    steps:

    - name: Download project
      uses: actions/checkout@v3

    - name: Prepare chromedriver
      run: |
        sudo apt install wget
        sudo apt install unzip
        wget https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing/115.0.5790.170/linux64/chromedriver-linux64.zip
        unzip chromedriver-linux64.zip
        cd chromedriver-linux64
        sudo chmod +x chromedriver
      shell: bash

    - name: Add chrome repository on distro
      run: |
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb
        sudo apt-get install -f
      shell: bash

    - name: Install google chrome version 15
      run: |
        sudo apt update
        sudo apt install google-chrome-stable=115.0.5790.170
      shell: bash
        
    - name: Download Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
  
    - name: Create virtual environment
      run: |
        python -m venv ambiente-teste
        source ambiente-teste/bin/activate
      shell: bash

    - name: Install Pytest
      run: |
        pip install -U pytest
        pytest --version
      shell: bash

    - name: Install Selenium  webdriver
      run: |
        pip install selenium
      shell: bash
      
    - name: Execute test
      run: |
        if [[ "${{ inputs.execution }}" == "" ]]
        then
          pytest -v tests/
        else
          pytest -v -m tests/"${{ inputs.execution }}"
        fi
      shell: bash

